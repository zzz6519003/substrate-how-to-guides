<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/substrate-how-to-guides/blog/rss.xml" title="Substrate How-to Guides Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/substrate-how-to-guides/blog/atom.xml" title="Substrate How-to Guides Blog Atom Feed"><title data-react-helmet="true">Simple crowdfund | Substrate How-to Guides</title><meta data-react-helmet="true" property="og:url" content="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/pallet-design/simple-crowdfund"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Simple crowdfund | Substrate How-to Guides"><meta data-react-helmet="true" name="description" content="_Using a child trie provides two advantages over using standard storage. First, it allows for"><meta data-react-helmet="true" property="og:description" content="_Using a child trie provides two advantages over using standard storage. First, it allows for"><meta data-react-helmet="true" name="keywords" content="pallet design, intermediate, runtime, child trie"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-how-to-guides/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/pallet-design/simple-crowdfund"><link data-react-helmet="true" rel="alternate" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/pallet-design/simple-crowdfund" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/pallet-design/simple-crowdfund" hreflang="x-default"><link rel="stylesheet" href="/substrate-how-to-guides/assets/css/styles.dd0e7a51.css">
<link rel="preload" href="/substrate-how-to-guides/assets/js/styles.c7ebc68f.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/runtime~main.11f2e3e9.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/main.e8d02469.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/1.277169ac.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/2.fddb2cdf.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/3.af03ba1b.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/1be78505.fe567aba.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/45.608dab4b.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/935f2afb.53bdcbda.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/43.764a5ff4.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/17896441.27874942.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/ae72b378.8af7df06.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-how-to-guides/"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Welcome</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/substrate-how-to-guides/"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Welcome</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></li><li class="menu__list-item"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-how-to-guides/docs/intro">Welcome</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-pallet-integration">Basic pallet integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/mint-token">Primitive token mint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/genesis-config-balances">Configuring genesis for Balances</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/configurable-constants">Configure a runtime constant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-tx-weight-calculations">Calculating transaction weights</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-instantiable-pallets">Basic instantiable pallets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/helper-functions">Using helper functions</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pallet design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/pallet-design/storage-value-struct">Create and use a struct in storage</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-how-to-guides/docs/pallet-design/simple-crowdfund">Simple crowdfund</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/pallet-design/lockable-currency">Simple staking pallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/pallet-design/add-contracts-pallet">Use the Contracts pallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/pallet-design/randomness">Generating on-chain randomness</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Weights</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/conditional-weight-struct">Conditional weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/linear-weight-struct">Linear weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/quadratic-weight-struct">Quadratic weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/calculate-fees">Calculating fees</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/testing/test-transfer">Testing a transfer function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/testing/basic-pallet-testing">Setting up tests for your pallet</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Storage Migrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/nicks-migration">Basic storage migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/migration-steps-polkadotjs">Trigger a storage migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/migration-tests">Migration tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/ringbuffer">Ringbuffer queue</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Consensus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/consensus/pow-consensus">Configure a chain to POW consensus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Kitties</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/overview">ðŸ˜º Substrate Kitties</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/basic-setup">Part I: Basic set-up</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/create-kitties">Part II: Uniqueness, custom types and storage maps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/dispatchables-and-events">Part III: Dispatchables and Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/interacting-functions">Part IV: Interacting with your Kitties</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/Tutorials/Kitties/kitties-frontend">Part V: Kitties front-end</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Want to Contribute?</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/contribute/how-to-template">How-to Template</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Simple crowdfund</h1></header><div class="markdown"><p><em>Using a child trie provides two advantages over using standard storage. First, it allows for
removing the entirety of the trie is a single storage write when the fund is dispensed or
dissolved. Second, it allows any contributor to prove that they contributed using a Merkle Proof.</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="goal"></a>Goal<a class="hash-link" href="#goal" title="Direct link to heading">#</a></h2><p>Build a pallet that controls multiple token accounts, storing data in child storage.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-cases"></a>Use cases<a class="hash-link" href="#use-cases" title="Direct link to heading">#</a></h2><p>A simple on-chain crowdfunding app for participants to pool funds towards a common goal.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>This guide demonstrates how to use one trie for each active crowdfund. Any user can start a crowdfund by
specifying a goal amount for the crowdfund, an end time, and a beneficiary who will
receive the pooled funds if the goal is reached by the end time. If the fund is not successful, it enters into a
retirement period when contributors can reclaim their pledged funds. Finally, an unsuccessful fund can be dissolved,
sending any remaining tokens to the user who dissolves it.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This guide assumes that developers know how to create their own <code>Errors</code> and <code>Events</code> according to the pallet logic they&#x27;re creating. </p></div></div><p>To follow this guide from scratch, use the template pallet with importing the following dependencies
which we&#x27;ll be needing:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    use frame_support::{pallet_prelude::*, ensure, storage::child,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        traits::{Currency, ExistenceRequirement, Get, ReservableCurrency, WithdrawReasons},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sp_runtime::{traits::{AccountIdConversion, Saturating, Zero, Hash},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ModuleId}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    use frame_system::{pallet_prelude::*, ensure_signed};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    use super::*;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="steps"></a>Steps<a class="hash-link" href="#steps" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-declaring-your-pallets-configuration-traits"></a>1. Declaring your pallet&#x27;s configuration traits<a class="hash-link" href="#1-declaring-your-pallets-configuration-traits" title="Direct link to heading">#</a></h3><p>In addition to the ubiquitous <code>Event</code> type, this pallet will need:</p><ul><li><code>Currency</code>. The currency in which the crowdfunds will be denominated.</li><li><code>SubmissionDeposit</code>. The amount to be held on deposit by the owner of a crowdfund.</li><li><code>MinContribution</code>. The minimum amount that may be contributed into a crowdfund.</li><li><code>RetirementPeriod</code>. The period of time in blocks during which contributors are able to
withdraw their funds after an unsuccessful crowdfund ending.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// The pallet&#x27;s configuration trait</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[pallet::config]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub trait Config: frame_system::Config {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type Event: From&lt;Event&lt;Self&gt;&gt; + IsType&lt;&lt;Self as frame_system::Config&gt;::Event&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type Currency: ReservableCurrency&lt;Self::AccountId&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type SubmissionDeposit: Get&lt;BalanceOf&lt;Self&gt;&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type MinContribution: Get&lt;BalanceOf&lt;Self&gt;&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type RetirementPeriod: Get&lt;Self::BlockNumber&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-create-a-custom-metadata-struct"></a>2. Create a custom metadata struct<a class="hash-link" href="#2-create-a-custom-metadata-struct" title="Direct link to heading">#</a></h3><p>Keep track of the constants in your pallet by creating a struct that stores metadata about each fund:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Encode, Decode, Default, PartialEq, Eq)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(feature = &quot;std&quot;, derive(Debug))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct FundInfo&lt;AccountId, Balance, BlockNumber&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The account that will recieve the funds if the campaign is successful.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    beneficiary: AccountId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The amount of deposit placed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deposit: Balance,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The total amount raised.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    raised: Balance,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Block number after which funding must have succeeded.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end: BlockNumber,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Upper bound on `raised`.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    goal: Balance,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-declare-your-storage-items"></a>3. Declare your storage items<a class="hash-link" href="#3-declare-your-storage-items" title="Direct link to heading">#</a></h3><p>Our storage items will need to keep track of which user contributed to what fund as well as how much they contributed. First, deine the following types which will be used to declare our storage items:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub type FundIndex = u32;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type AccountIdOf&lt;T&gt; = &lt;T as frame_system::Config&gt;::AccountId;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type BalanceOf&lt;T&gt; = &lt;&lt;T as Config&gt;::Currency as Currency&lt;AccountIdOf&lt;T&gt;&gt;&gt;::Balance;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type FundInfoOf&lt;T&gt; =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FundInfo&lt;AccountIdOf&lt;T&gt;, BalanceOf&lt;T&gt;, &lt;T as frame_system::Config&gt;::BlockNumber&gt;;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now, use those types to create one <code>StorageMap</code> item that tracks the funds by index and a second, <code>StorageValue</code>, that keeps track of <code>FundIndex</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[pallet::storage]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[pallet::getter(fn funds)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Info on all of the funds.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub(super) type Funds&lt;T: Config&gt; = StorageMap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;   _, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Blake2_128Concat, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FundIndex, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FundInfoOf&lt;T&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        OptionQuery,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[pallet::storage]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[pallet::getter(fn fund_count)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The total number of funds that have so far been allocated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub(super) type FundCount&lt;T: Config&gt; = StorageValue&lt;_, FundIndex, ValueQuery&gt;;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-write-child-trie-api-helper-functions"></a>4. Write child trie API helper functions<a class="hash-link" href="#4-write-child-trie-api-helper-functions" title="Direct link to heading">#</a></h3><p>First, we&#x27;ll need to create a function that provides the pallet&#x27;s dispatchables with the account ID for the pot of funds. Inside <code>impl&lt;T: Config&gt; Pallet&lt;T&gt;</code>, write:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">const PALLET_ID: ModuleId = ModuleId(*b&quot;ex/cfund&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**snip**/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn fund_account_id(index: FundIndex) -&gt; T::AccountId {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    PALLET_ID.into_sub_account(index)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then, we&#x27;ll need to generate unique [ChildInfo][childinfo-rustdocs] IDs:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn id_from_index(index: FundIndex) -&gt; child::ChildInfo {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut buf = Vec::new();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    buf.extend_from_slice(b&quot;crowdfnd&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    buf.extend_from_slice(&amp;index.to_le_bytes()[..]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    child::ChildInfo::new_default(T::Hashing::hash(&amp;buf[..]).as_ref())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Finally, we can write the following helper functions that make use of the <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/index.html#functions" target="_blank" rel="noopener noreferrer">Child API</a>:</p><p><code>pub fn contribution_put</code>:</p><ul><li>record a contribution in the associated child trie using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/fn.put.html" target="_blank" rel="noopener noreferrer"><code>put</code></a></li></ul><p><code>pub fn contribution_get</code>:</p><ul><li>lookup a contribution in the associated child trie using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/fn.get_or_default.html" target="_blank" rel="noopener noreferrer"><code>get</code></a></li></ul><p><code>pub fn contribution_kil</code>: </p><ul><li>remove a contribution from an associated child trie using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/fn.kill.html" target="_blank" rel="noopener noreferrer"><code>kill</code></a></li></ul><p><code>pub fn crowdfund_kill</code>:</p><ul><li>remove the entire record of contributions in the associated child trie in a single storage write using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/fn.kill_storage.html" target="_blank" rel="noopener noreferrer"><code>kill_storage</code></a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-write-dispatchable-functions"></a>5. Write dispatchable functions<a class="hash-link" href="#5-write-dispatchable-functions" title="Direct link to heading">#</a></h3><p>The follow steps outline how to write the dispatchables for this pallet. After various checks within the dispatchables&#x27; logic, each function alters the <code>Funds&lt;T&gt;</code> storage map using its <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/pallet_prelude/struct.StorageMap.html" target="_blank" rel="noopener noreferrer">associated methods</a>. Our pallet&#x27;s <code>create</code> function also makes use of the <code>FundInfo</code> struct previously created. Learn how to use a storage struct in <a href="/substrate-how-to-guides/storage-value-struct">this how-to guide</a>. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="create-a-new-fund"></a>Create a new fund<a class="hash-link" href="#create-a-new-fund" title="Direct link to heading">#</a></h4><p><code>fn create</code>:</p><ul><li>create an imbalance variable using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/traits/trait.Currency.html#tymethod.withdraw" target="_blank" rel="noopener noreferrer"><code>T::Currency::withdraw</code></a></li><li>update the <code>Funds</code> storage item using the <code>FundInfo</code> struct from <a href="#2-create-a-custom-metadata-struct">step 2</a></li><li>deposit a <code>Created</code> event
</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="contribute-funds-to-an-existing-fund"></a>Contribute funds to an existing fund<a class="hash-link" href="#contribute-funds-to-an-existing-fund" title="Direct link to heading">#</a></h4><p><code>fn contribute</code>:</p><ul><li>perform preliminary safety checks using <code>ensure!</code></li><li>add the contribution to the fund using <code>T::Currency::transfer</code></li><li>record the contribution in the child trie using the helper function <code>contribution_put</code></li><li>deposit a <code>Contributed</code> event</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="withdraw-full-balance-of-a-contributor-to-a-fund"></a>Withdraw full balance of a contributor to a fund<a class="hash-link" href="#withdraw-full-balance-of-a-contributor-to-a-fund" title="Direct link to heading">#</a></h4><p><code>fn withdraw</code>:</p><ul><li>perform preliminary safety checks using <code>ensure!</code></li><li>return funds by using <a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/traits/trait.Currency.html#method.resolve_into_existing" target="_blank" rel="noopener noreferrer"><code>T::Currency::resolve_into_existing</code></a></li><li>calculate new balances and update storage using child trie helper functions <code>funds</code>, <code>contribution_get</code> and <code>contribution_kill</code></li><li>deposit <code>Withdrew</code> event</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dissolve-an-entire-crowdfund-after-its-retirement-period-has-expired"></a>Dissolve an entire crowdfund after its retirement period has expired.<a class="hash-link" href="#dissolve-an-entire-crowdfund-after-its-retirement-period-has-expired" title="Direct link to heading">#</a></h4><p><code>fn dissolve</code>: </p><ul><li>perform preliminary safety checks using <code>ensure!</code></li><li>allow dissolver to collect funds by using <a href="https://crates.parity.io/frame_support/traits/tokens/currency/trait.Currency.html#method.resolve_creating" target="_blank" rel="noopener noreferrer"><code>T::Currency::resolve_creating</code></a> for dissolver to collect funds</li><li>use the child trie helper function <code>crowdfund_kill</code> to remove contributor info from storage</li><li>deposit <code>Dissolved</code> event</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dispense-a-payment-to-the-beneficiary-of-a-successful-crowdfund"></a>Dispense a payment to the beneficiary of a successful crowdfund<a class="hash-link" href="#dispense-a-payment-to-the-beneficiary-of-a-successful-crowdfund" title="Direct link to heading">#</a></h4><p><code>fn dispense</code>:</p><ul><li>use <a href="https://crates.parity.io/frame_support/traits/tokens/currency/trait.Currency.html#method.resolve_creating" target="_blank" rel="noopener noreferrer"><code>T::Currency::resolve_creating</code></a> for beneficiary and caller (separately) to collect funds</li><li>give initial deposit to account who calls this function as an incentive to clean up storage</li><li>remove the fund from storage using <code>&lt;Funds&lt;T&gt;&gt;::remove(index);</code> and <code>Self::crowdfund_kill(index);</code> to remove all contributors from storage in a single write</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples"></a>Examples<a class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/blob/main/example-code/template-node/pallets/simple-crowdfund/src/lib.rs#L1" target="_blank" rel="noopener noreferrer"><code>pallet_simple_crowdfund</code></a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resources"></a>Resources<a class="hash-link" href="#resources" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-guides"></a>How-to guides<a class="hash-link" href="#how-to-guides" title="Direct link to heading">#</a></h4><ul><li><a href="/substrate-how-to-guides/storage-value-struct">Create a struct in storage</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rust-docs"></a>Rust docs<a class="hash-link" href="#rust-docs" title="Direct link to heading">#</a></h4><ul><li><a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/traits/trait.Imbalance.html" target="_blank" rel="noopener noreferrer">Currency Imbalance trait</a> </li><li><a href="https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/child/index.html#functions" target="_blank" rel="noopener noreferrer">Child trie API</a></li><li><a href="https://crates.parity.io/frame_support/dispatch/struct.Vec.html#method.extend_from_slice" target="_blank" rel="noopener noreferrer"><code>extend_from_slice</code></a></li><li><a href="https://crates.parity.io/frame_support/pallet_prelude/trait.Encode.html#method.using_encoded" target="_blank" rel="noopener noreferrer"><code>using_encode</code></a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/02-pallet-design/simple-crowdfund.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-how-to-guides/docs/pallet-design/storage-value-struct"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Create and use a struct in storage</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-how-to-guides/docs/pallet-design/lockable-currency"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Simple staking pallet Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal" class="table-of-contents__link">Goal</a></li><li><a href="#use-cases" class="table-of-contents__link">Use cases</a></li><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#steps" class="table-of-contents__link">Steps</a><ul><li><a href="#1-declaring-your-pallets-configuration-traits" class="table-of-contents__link">1. Declaring your pallet&#39;s configuration traits</a></li><li><a href="#2-create-a-custom-metadata-struct" class="table-of-contents__link">2. Create a custom metadata struct</a></li><li><a href="#3-declare-your-storage-items" class="table-of-contents__link">3. Declare your storage items</a></li><li><a href="#4-write-child-trie-api-helper-functions" class="table-of-contents__link">4. Write child trie API helper functions</a></li><li><a href="#5-write-dispatchable-functions" class="table-of-contents__link">5. Write dispatchable functions</a></li></ul></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li><li><a href="#resources" class="table-of-contents__link">Resources</a></li></ul></div></div></div><div><fieldset class="MuiBox-root jss14"><legend class="MuiTypography-root MuiTypography-body1">Was this guide useful?</legend><span class="MuiRating-root"><label class="MuiRating-label" for="customized-icons-1"><span class="MuiRating-icon MuiRating-iconFilled"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-2.33 0-4.32 1.45-5.12 3.5h1.67c.69-1.19 1.97-2 3.45-2s2.75.81 3.45 2h1.67c-.8-2.05-2.79-3.5-5.12-3.5z"></path></svg></span><span class="MuiRating-visuallyhidden">Very Dissatisfied</span></label><input type="radio" value="1" id="customized-icons-1" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-2"><span class="MuiRating-icon MuiRating-iconFilled"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-3.5c.73 0 1.39.19 1.97.53.12-.14.86-.98 1.01-1.14-.85-.56-1.87-.89-2.98-.89-1.11 0-2.13.33-2.99.88.97 1.09.01.02 1.01 1.14.59-.33 1.25-.52 1.98-.52z"></path></svg></span><span class="MuiRating-visuallyhidden">Dissatisfied</span></label><input type="radio" value="2" id="customized-icons-2" name="customized-icons" checked="" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-3"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-4c-.73 0-1.38-.18-1.96-.52-.12.14-.86.98-1.01 1.15.86.55 1.87.87 2.97.87 1.11 0 2.12-.33 2.98-.88-.97-1.09-.01-.02-1.01-1.15-.59.35-1.24.53-1.97.53z"></path></svg></span><span class="MuiRating-visuallyhidden">Neutral</span></label><input type="radio" value="3" id="customized-icons-3" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-4"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M12 16c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.69 1.19-1.97 2-3.45 2zm-.01-14C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg></span><span class="MuiRating-visuallyhidden">Satisfied</span></label><input type="radio" value="4" id="customized-icons-4" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-5"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-5-6c.78 2.34 2.72 4 5 4s4.22-1.66 5-4H7z"></path></svg></span><span class="MuiRating-visuallyhidden">Very Satisfied</span></label><input type="radio" value="5" id="customized-icons-5" name="customized-icons" class="MuiRating-visuallyhidden"></span></fieldset></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn Substrate</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/substrate-how-to-guides/docs/tutorials/kitties/overview">Tutorials</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">The Substrate How-to Guides are GPL 3.0 Licensed, open source and open for contributions.</div></div></div></footer></div>
<script src="/substrate-how-to-guides/assets/js/styles.c7ebc68f.js"></script>
<script src="/substrate-how-to-guides/assets/js/runtime~main.11f2e3e9.js"></script>
<script src="/substrate-how-to-guides/assets/js/main.e8d02469.js"></script>
<script src="/substrate-how-to-guides/assets/js/1.277169ac.js"></script>
<script src="/substrate-how-to-guides/assets/js/2.fddb2cdf.js"></script>
<script src="/substrate-how-to-guides/assets/js/3.af03ba1b.js"></script>
<script src="/substrate-how-to-guides/assets/js/1be78505.fe567aba.js"></script>
<script src="/substrate-how-to-guides/assets/js/45.608dab4b.js"></script>
<script src="/substrate-how-to-guides/assets/js/935f2afb.53bdcbda.js"></script>
<script src="/substrate-how-to-guides/assets/js/43.764a5ff4.js"></script>
<script src="/substrate-how-to-guides/assets/js/17896441.27874942.js"></script>
<script src="/substrate-how-to-guides/assets/js/ae72b378.8af7df06.js"></script>
</body>
</html>